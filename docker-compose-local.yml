# Simplified local development stack
# Services: PostgreSQL, Redis, LocalStack (S3)
# No RabbitMQ, no MongoDB, no Minio

services:
  plane-db:
    image: postgres:15.7-alpine
    restart: unless-stopped
    networks:
      - dev_env
    command: postgres -c 'max_connections=1000'
    volumes:
      - pgdata:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: plane
      POSTGRES_PASSWORD: plane
      POSTGRES_DB: plane
      PGDATA: /var/lib/postgresql/data
    ports:
      - "5432:5432"

  plane-redis:
    image: valkey/valkey:7.2.11-alpine
    restart: unless-stopped
    networks:
      - dev_env
    volumes:
      - redisdata:/data
    ports:
      - "6379:6379"

  localstack:
    image: localstack/localstack:latest
    restart: unless-stopped
    networks:
      - dev_env
    environment:
      - SERVICES=s3
      - DEBUG=0
      - DATA_DIR=/var/lib/localstack/data
    volumes:
      - localstack-data:/var/lib/localstack
      - /var/run/docker.sock:/var/run/docker.sock
      - ./scripts/init-localstack.sh:/etc/localstack/init/ready.d/init-aws.sh:ro
    ports:
      - "4566:4566"

volumes:
  pgdata:
  redisdata:
  localstack-data:

networks:
  dev_env:
    driver: bridge
