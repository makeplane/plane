FROM node:22-alpine

RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY . .
RUN corepack enable pnpm && pnpm add -g turbo
RUN pnpm install

# Build the live service
RUN pnpm turbo run build --filter=live

EXPOSE 3000

ENV TURBO_TELEMETRY_DISABLED=1

# Run node directly instead of through pnpm/turbo to ensure env vars pass through
CMD ["node", "apps/live/dist/start.mjs"]
