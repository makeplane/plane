# Nginx Reverse Proxy Configuration

This directory contains nginx configuration files for setting up a reverse proxy with SSL support.

## Quick Start

### Development (Self-Signed SSL)

```bash
# Install and configure nginx with self-signed SSL
make nginx-setup
make ssl-setup

# Start nginx
make nginx-start
```

### Production (Let's Encrypt SSL)

```bash
# Install nginx
make nginx-setup

# Set up Let's Encrypt SSL
make ssl-letsencrypt DOMAIN=yourdomain.com EMAIL=admin@yourdomain.com

# Start nginx
make nginx-start
```

## Manual Installation

### Linux (Ubuntu/Debian)

```bash
# Install nginx
sudo apt-get install -y nginx

# Copy configuration
sudo cp nginx/nginx.conf /etc/nginx/sites-available/familyflow
sudo ln -s /etc/nginx/sites-available/familyflow /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default

# Set up SSL
sudo ./nginx/setup-ssl.sh

# Test and start
sudo nginx -t
sudo systemctl restart nginx
```

### macOS (Homebrew)

```bash
# Install nginx
brew install nginx

# Run installation script
./nginx/install.sh

# Or manually:
# Copy config to Homebrew nginx directory
# Set up SSL certificates
# Start nginx
```

## Configuration

The nginx configuration (`nginx.conf`) routes:

- `/api/*` → API backend (port 8000)
- `/auth/*` → API backend (port 8000)
- `/static/*` → API backend (port 8000) - static files
- `/media/*` → API backend (port 8000) - media files
- `/god-mode/*` → API backend (port 8000) - proxied to admin app
- `/` → Web frontend (port 3000)

## SSL Certificates

### Development (Self-Signed)

Self-signed certificates are automatically generated by `setup-ssl.sh`. These will show a security warning in browsers, which is normal for development.

### Production (Let's Encrypt)

For production, use Let's Encrypt:

```bash
# Install certbot
sudo apt-get install -y certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Auto-renewal is set up automatically
```

Then update `nginx.conf` to use the Let's Encrypt certificates:

```nginx
ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
```

## Makefile Commands

- `make nginx-setup` - Install and configure nginx
- `make nginx-start` - Start nginx
- `make nginx-stop` - Stop nginx
- `make nginx-restart` - Restart nginx
- `make nginx-reload` - Reload configuration
- `make nginx-test` - Test configuration
- `make ssl-setup` - Set up self-signed SSL
- `make ssl-letsencrypt DOMAIN=... EMAIL=...` - Set up Let's Encrypt

## Troubleshooting

### Check nginx status
```bash
sudo systemctl status nginx  # Linux
brew services list | grep nginx  # macOS
```

### View logs
```bash
sudo tail -f /var/log/nginx/familyflow-access.log
sudo tail -f /var/log/nginx/familyflow-error.log
```

### Test configuration
```bash
sudo nginx -t
```

### Reload after changes
```bash
sudo nginx -s reload
# or
make nginx-reload
```

